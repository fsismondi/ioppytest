# -*- coding: utf-8 -*-
--- !testcase
testcase_id: TD_COAP_CORE_01
uri : http://doc.f-interop.eu/tests/TD_COAP_CORE_01
configuration: COAP_CFG_01
objective: Perform GET transaction(CON mode)
pre_conditions:
  - Server offers the resource /test with resource content is not empty that handles GET with an arbitrary payload
notes: We acknowledge the efforts made by ETSI CTI and ProbeIT who have contributed to the content of this document
references: '[COAP] 5.8.1, 1.2, 2.1, 2.2, 3.1'
sequence:
  - step_id: TD_COAP_CORE_01_step_01
    type: stimuli
    node : coap_client
    description:
      - 'Client is requested to send a GET request with'
      - - Type = 0(CON)
        - Code = 1(GET)

  - step_id: TD_COAP_CORE_01_step_02
    type: check
    description:
      - 'The request sent by the client contains'
      - - Type=0 and Code=1
        - Client-generated Message ID (* CMID)
        - Client-generated Token (* CTOK)
        - UTEST Uri-Path option "test"

  - step_id: TD_COAP_CORE_01_step_03
    type: check
    description:
        - 'Server sends response containing'
        - - Code = 2.05(Content)
          - Message ID = CMID, Token = CTOK
          - Content-format option
          - Non-empty Payload

  - step_id: TD_COAP_CORE_01_step_04
    type: verify
    node: coap_client
    description:
        - 'Client displays the received information'

--- !testcase

testcase_id : TD_COAP_CORE_02
uri : http://doc.f-interop.eu/tests/TD_COAP_CORE_02
objective: Perform DELETE transaction (CON mode)
configuration: COAP_CFG_01
references: "[COAP] 5.8.4, 1.2, 2.1, 2.2, 3.1"
pre_conditions:
  - Server offers a /test resource that handles DELETE
notes: We acknowledge the efforts made by ETSI CTI and ProbeIT who have contributed to the content of this document
sequence:

  - step_id : TD_COAP_CORE_02_step_01
    type : stimuli
    node : coap_client
    description:
      - 'Client is requested to send a DELETE request with:'
      - - Type = 0 (CON)
        - Code = 4 (DELETE)

  - step_id : TD_COAP_CORE_02_step_02
    type : check
    description:
      - 'The request sent by the client contains:'
      - - Type=0 and Code=4
        - Client-generated Message ID (* CMID)
        - Client-generated Token (* CTOK)
        - Uri-Path option "test"

  - step_id : TD_COAP_CORE_02_step_03
    type : check
    description:
      - 'Server sends response containing:'
      - - Code = 2.02 (Deleted)
        - Message ID = CMID, Token = CTOK
        - Content-format option if payload non-empty
        - Empty or non-empty Payload

  - step_id : TD_COAP_CORE_02_step_04
    type : verify
    node : coap_client
    description:
        - 'Client displays the received information'

--- !testcase

testcase_id : TD_COAP_CORE_03
uri : http://doc.f-interop.eu/tests/TD_COAP_CORE_03
objective: Perform PUT transaction (CON mode)
configuration: COAP_CFG_01
references: "[COAP] 5.8.3, 1.2, 2.1, 2.2, 3.1"
pre_conditions:
  - Server offers already available resource /test or accepts creation of new resource on /test that handles PUT
notes: We acknowledge the efforts made by ETSI CTI and ProbeIT who have contributed to the content of this document
sequence:

- step_id : TD_COAP_CORE_03_step_01
  type : stimuli
  node : coap_client
  description:
    - 'Client is requested to send a PUT request with:'
    - - Type = 0 (CON)
      - Code = 3 (PUT)
      - Content-format option
      - Empty or non-empty Payload

- step_id : TD_COAP_CORE_03_step_02
  type : check
  description:
    - 'The request sent by the client contains:'
    - - Type=0 and Code=3
      - Client-generated Message ID (* CMID)
      - Client-generated Token (* CTOK)
      - Uri-Path option "test"


- step_id : TD_COAP_CORE_03_step_03
  type : verify
  node : coap_server
  description:
    - Server displays received information

- step_id : TD_COAP_CORE_03_step_04
  type : check
  description:
    - 'Server sends response containing:'
    - - Code = 2.04 (Changed) or 2.01 (Created)
      - Message ID = CMID, Token = CTOK
      - Content-format option if payload non-empty
      - Empty or non-empty Payload


- step_id : TD_COAP_CORE_03_step_05
  type : verify
  node : coap_client
  description:
    - 'Client displays the received response'

--- !testcase


testcase_id : TD_COAP_CORE_04
uri : http://doc.f-interop.eu/tests/TD_COAP_CORE_04
objective: Perform POST transaction (CON mode)
configuration: COAP_CFG_01
references: "[COAP] 5.8.2, 1.2, 2.1, 2.2, 3.1"
pre_conditions:
  - Server accepts POST request on /test
notes: We acknowledge the efforts made by ETSI CTI and ProbeIT who have contributed to the content of this document
sequence:

  - step_id : TD_COAP_CORE_04_step_01
    type : stimuli
    node : coap_client
    description:
      - 'Client is requested to send a POST request with:'
      - - Type = 0 (CON)
        - Code = 2 (POST)
        - Content-format option
        - Empty or non-empty Payload

  - step_id : TD_COAP_CORE_04_step_02
    type : check
    description:
      - 'The request sent by the client contains:'
      - - Type=0 and Code=2
        - Client-generated Message ID (* CMID)
        - Client-generated Token (* CTOK)

  - step_id : TD_COAP_CORE_04_step_03
    type : verify
    node : coap_server
    description:
      - Server displays received information

  - step_id : TD_COAP_CORE_04_step_04
    type : check
    description:
      - 'Server sends response containing:'
      - - Code = 2.04 (Changed) or 2.01 (Created)
        - Message ID = CMID, Token = CTOK
        - Content-format option
        - Zero or more Location-path option
        - Empty or non-empty Payload

  - step_id : TD_COAP_CORE_04_step_05
    type : verify
    node : coap_client
    description:
      - 'Client displays the received response'

--- !testcase

testcase_id : TD_COAP_CORE_05
uri : http://doc.f-interop.eu/tests/TD_COAP_CORE_05
objective: Perform GET transaction (NON mode)
configuration: COAP_CFG_01
references: "[COAP] 5.8.1, 5.2.3"
pre_conditions:
  - Server offers a /test resource with resource content is not empty that handles GET
notes: We acknowledge the efforts made by ETSI CTI and ProbeIT who have contributed to the content of this document
sequence:

  - step_id : TD_COAP_CORE_05_step_01
    type : stimuli
    node : coap_client
    description:
      - 'Client is requested to send a GET request with:'
      - - Type = 1 (NON)
        - Code = 1 (GET)

  - step_id : TD_COAP_CORE_05_step_02
    type : check
    description:
      - 'The request sent by the client contains:'
      - - Type=1 and Code=4
        - Client-generated Message ID (* CMID)
        - Client-generated Token (* CTOK)

  - step_id : TD_COAP_CORE_05_step_03
    type : check
    description:
      - 'Server sends response containing:'
      - - Type=1 (NON)
        - Code = 2.05 (Content)
        - Server-generated Message ID (* SMID)
        - Token = CTOK
        - Content-format option

  - step_id : TD_COAP_CORE_05_step_04
    type : verify
    node : coap_client
    description:
      - 'Client displays the received response'

--- !testcase

testcase_id : TD_COAP_CORE_06
uri : http://doc.f-interop.eu/tests/TD_COAP_CORE_06
objective: Perform DELETE transaction (NON mode)
configuration: COAP_CFG_01
references: "[COAP] 5.8.4, 5.2.3"
pre_conditions:
  - Server offers a /test resource that handles DELETE
notes: We acknowledge the efforts made by ETSI CTI and ProbeIT who have contributed to the content of this document
sequence:

  - step_id : TD_COAP_CORE_06_step_01
    type : stimuli
    node : coap_client
    description:
      - 'Client is requested to send a DELETE request with:'
      - - Type = 1 (NON)
        - Code = 4 (DELETE)

  - step_id : TD_COAP_CORE_06_step_02
    type : check
    description:
      - 'The request sent by the client contains:'
      - - Type=1 and Code=4
        - Client-generated Message ID (* CMID)
        - Client-generated Token (* CTOK)

  - step_id : TD_COAP_CORE_06_step_03
    type : check
    description:
      - 'Server sends response containing:'
      - - Type=1 (NON)
        - Code = 2.02 (Delete)
        - Server-generated Message ID (* SMID)
        - Token = CTOK
        - Empty or non-empty Payload
        - Content-format option if payload non-empty

  - step_id : TD_COAP_CORE_06_step_04
    type : verify
    node : coap_client
    description:
      - 'Client displays the received response'

--- !testcase

testcase_id : TD_COAP_CORE_07
uri : http://doc.f-interop.eu/tests/TD_COAP_CORE_07
objective: Perform PUT transaction (NON mode)
configuration: COAP_CFG_01
references: "[COAP] 5.8.3, 5.2.3"
pre_conditions:
  - Server offers a /test resource that handles PUT
notes: We acknowledge the efforts made by ETSI CTI and ProbeIT who have contributed to the content of this document
sequence:

  - step_id : TD_COAP_CORE_07_step_01
    type : stimuli
    node : coap_client
    description:
      - 'Client is requested to send a PUT request with:'
      - - Type = 1 (NON)
        - Code = 3 (PUT)
        - An arbitrary payload
        - Content-format option

  - step_id : TD_COAP_CORE_07_step_02
    type : check
    description:
      - 'The request sent by the client contains:'
      - - Type=1 and Code=3
        - Client-generated Message ID (* CMID)
        - Client-generated Token (* CTOK)

  - step_id : TD_COAP_CORE_07_step_03
    type : verify
    node : coap_server
    description:
      - 'Server displays the received response'

  - step_id : TD_COAP_CORE_07_step_04
    type : check
    description:
      - 'Server sends response containing:'
      - - Type=1 (NON)
        - Code=2.04(Changed) or 2.01 (Created)
        - Server-generated Message ID (* SMID)
        - Token = CTOK
        - Content-format option if payload non-empty
        - Empty or non-empty Payload

  - step_id : TD_COAP_CORE_07_step_05
    type : verify
    node : coap_client
    description:
      - 'Client displays the received response'

--- !testcase

testcase_id : TD_COAP_CORE_08
uri : http://doc.f-interop.eu/tests/TD_COAP_CORE_08
objective: Perform POST transaction (NON mode)
configuration: COAP_CFG_01
references: "[COAP] 5.8.2, 5.2.3"
pre_conditions:
  - Server accepts POST request on /test
notes: We acknowledge the efforts made by ETSI CTI and ProbeIT who have contributed to the content of this document
sequence:

  - step_id : TD_COAP_CORE_08_step_01
    type : stimuli
    node : coap_client
    description:
      - 'Client is requested to send a POST request with:'
      - - Type = 1 (NON)
        - Code = 2 (POST)
        - An arbitrary payload
        - Content-format option

  - step_id : TD_COAP_CORE_08_step_02
    type : check
    description:
      - 'The request sent by the client contains:'
      - - Type=1 and Code=2
        - Client-generated Message ID (* CMID)
        - Client-generated Token (* CTOK)
        - An arbitrary payload
        - Content-format option

  - step_id : TD_COAP_CORE_08_step_03
    type : verify
    node : coap_server
    description:
      - 'Server displays the received response'

  - step_id : TD_COAP_CORE_08_step_04
    type : check
    description:
      - 'Server sends response containing:'
      - - Type=1 (NON)
        - Code=2.01(Created) or 2.04 (Changed)
        - Server-generated Message ID (* SMID)
        - Token = CTOK
        - Zero or more Location-path options
        - Content-format option if payload non-empty
        - Empty or non-empty Payload

  - step_id : TD_COAP_CORE_08_step_05
    type : verify
    node : coap_client
    description:
      - 'Client displays the received response'

--- !testcase

testcase_id : TD_COAP_CORE_09
uri : http://doc.f-interop.eu/tests/TD_COAP_CORE_09
objective: Perform GET transaction with separate response(CON mode, no piggyback)
configuration: COAP_CFG_01
references: "[COAP] 5.8.1, 5.2.2"
pre_conditions:
  - Server offers a resource /separate which is not served immediately and which therefore is not acknowledged in a piggybacked way
notes: We acknowledge the efforts made by ETSI CTI and ProbeIT who have contributed to the content of this document
sequence:

  - step_id : TD_COAP_CORE_09_step_01
    type : stimuli
    node : coap_client
    description:
      - "Client is requested to send a confirmable GET request to server's resource"

  - step_id : TD_COAP_CORE_09_step_02
    type : check
    description:
      - 'The request sent by the client contains:'
      - - Type=0 (CON)
        - Code=1 (GET)
        - Client-generated Message ID (* CMID)

  - step_id : TD_COAP_CORE_09_step_03
    type : check
    description:
      - 'Server sends response containing:'
      - - Type=2 (ACK)
        - Code=0
        - Message ID = CMID
        - Empty Payload

  - step_id : TD_COAP_CORE_09_step_04
    type : check
    description:
      - 'Server sends response containing:'
      - - Type=0 (CON)
        - Code=2.05(Content)
        - Server-generated Message ID (* SMID)
        - Token = CTOK
        - Content-format option
        - Non-empty Payload
#Some time (aa couple of seconds) elapses
  - step_id : TD_COAP_CORE_09_step_05
    type : check
    description:
      - 'Server sends response containing:'
      - - Type=2 (ACK)
        - Code=0
        - Message ID = SMID
        - Empty Payload

  - step_id : TD_COAP_CORE_09_step_06
    type : verify
    node : coap_client
    description:
      - 'Client displays the response'

--- !testcase

testcase_id : TD_COAP_CORE_10
uri : http://doc.f-interop.eu/tests/TD_COAP_CORE_10
objective: Perform GET transaction containing non-empty Token (CON mode)
configuration: COAP_CFG_01
references: "[COAP] 2.2, 5.8.1, 5.10.1"
pre_conditions:
  - Server offers a /test resource with content is not empty that handles GET
notes: We acknowledge the efforts made by ETSI CTI and ProbeIT who have contributed to the content of this document
sequence:

  - step_id : TD_COAP_CORE_10_step_01
    type : stimuli
    node : coap_client
    description:
      - "Client is requested to send a GET request to server's resource with non-empty Token option"

  - step_id : TD_COAP_CORE_10_step_02
    type : check
    description:
      - 'The request sent by the client contains:'
      - - Type=0 (CON)
        - Code=1 (GET)
        - Client-generated Message ID (* CMID)
        - Client-generated Token (* CTOK)
        - Length of the token should be between 1 to 8 Bytes

  - step_id : TD_COAP_CORE_10_step_03
    type : check
    description:
      - 'Server sends response containing:'
      - - Code=2.05 (Content)
        - Message ID = CMID
        - Token = CTOK
        - Content-format option
        - Non-empty Payload

  - step_id : TD_COAP_CORE_10_step_04
    type : verify
    node : coap_client
    description:
      - 'Client displays the response'

--- !testcase

testcase_id : TD_COAP_CORE_11
uri : http://doc.f-interop.eu/tests/TD_COAP_CORE_11
objective: Perform GET transaction containing non-empty Token with a separate response (CON mode)
configuration: COAP_CFG_01
references: "[COAP] 2.2, 5.2.2, 5.8.1"
pre_conditions:
  - Server offers a resource /separate which is not served immediately and which therefore is not acknowledged in a piggybacked way
notes: We acknowledge the efforts made by ETSI CTI and ProbeIT who have contributed to the content of this document
sequence:

  - step_id : TD_COAP_CORE_11_step_01
    type : stimuli
    node : coap_client
    description:
      - "Client is requested to send a GET request to server's resource including Token option"

  - step_id : TD_COAP_CORE_11_step_02
    type : check
    description:
      - 'The request sent by the client contains:'
      - - Type=0 (CON)
        - Code=1 (GET)
        - Client-generated Message ID (* CMID)
        - Client-generated Token (* CTOK)
        - Length of the token should be between 1 to 8 Bytes

  - step_id : TD_COAP_CORE_11_step_03
    type : check
    description:
      - 'Server sends response containing:'
      - - Type=2 (ACK)
        - Code=0
        - Message ID = CMID
        - Empty Payload

  - step_id : TD_COAP_CORE_11_step_04
    type : check
    description:
      - 'Server sends response containing:'
      - - Type=0 (CON)
        - Code=2.05 (Content)
        - Server-generated Message ID (* SMID)
        - Token = CTOK
        - Non-empty Payload

  - step_id : TD_COAP_CORE_11_step_05
    type : check
    description:
      - 'Client sends response containing:'
      - - Type=2 (ACK)
        - Code=0
        - Message ID = SMID
        - Empty Payload

  - step_id : TD_COAP_CORE_11_step_06
    type : verify
    node : coap_client
    description:
      - 'Client displays the response'

--- !testcase

testcase_id : TD_COAP_CORE_12
uri : http://doc.f-interop.eu/tests/TD_COAP_CORE_12
objective: Perform GET transaction using empty Token (CON mode)
configuration: COAP_CFG_01
references: "[COAP] 2.2, 5.10.1, 5.8.1"
pre_conditions:
  - Server offers a resource /test with resource content is not empty that handles GEt with an arbitrary payload
notes: We acknowledge the efforts made by ETSI CTI and ProbeIT who have contributed to the content of this document
sequence:

  - step_id : TD_COAP_CORE_12_step_01
    type : stimuli
    node : coap_client
    description:
      - "Client is requested to send a confirmable GET request using zero-length Token to server's resource"

  - step_id : TD_COAP_CORE_12_step_02
    type : check
    description:
      - 'The request sent by the client contains:'
      - - Type=0 (CON)
        - Code=1 (GET)
        - Zero-Length Token * CTOK

  - step_id : TD_COAP_CORE_12_step_03
    type : check
    description:
      - 'Server sends response containing:'
      - - Code=2.05 (Content)
        - Message ID = CMID, Token = CTOK
        - Content-format option
        - Non-empty Payload

  - step_id : TD_COAP_CORE_12_step_04
    type : verify
    node : coap_client
    description:
      - 'Client displays the response'

--- !testcase

testcase_id : TD_COAP_CORE_13
uri : http://doc.f-interop.eu/tests/TD_COAP_CORE_13
objective: Perform GET transaction containing several URI-Path options (CON mode)
configuration: COAP_CFG_01
references: "[COAP] 5.4.5, 5.10.2, 6.5"
pre_conditions:
  - Server offers a /seg1/seg2/seg3 resource with resource content is not empty
notes: We acknowledge the efforts made by ETSI CTI and ProbeIT who have contributed to the content of this document
sequence:

  - step_id : TD_COAP_CORE_13_step_01
    type : stimuli
    node : coap_client
    description:
      - "Client is requested to send a confirmable GET request to server's resource"

  - step_id : TD_COAP_CORE_13_step_02
    type : check
    description:
      - 'The request sent by the client contains:'
      - - Type=0 (CON)
        - Code=1 (GET)
        - Client-generated Message ID (* CMID)
        - Client-generated Token (* CTOK)
      - 'and three options of type Uri-Path, with the values:'
      - - seg1
        - seg2
        - seg3

  - step_id : TD_COAP_CORE_13_step_03
    type : check
    description:
      - 'Server sends response containing:'
      - - Code=2.05 (Content)
        - Message ID = CMID, Token = CTOK
        - Content-format option
        - Non-empty Payload

  - step_id : TD_COAP_CORE_13_step_04
    type : verify
    node : coap_client
    description:
      - 'Client displays the response'

--- !testcase

testcase_id : TD_COAP_CORE_14
uri : http://doc.f-interop.eu/tests/TD_COAP_CORE_14
objective: Perform GET transaction containing several URI-Query options (CON mode)
configuration: COAP_CFG_01
references: "[COAP] 5.4.5, 5.10.2, 6.5"
pre_conditions:
  - Server offers a /query resource with resource content is not empty
notes: We acknowledge the efforts made by ETSI CTI and ProbeIT who have contributed to the content of this document
sequence:

  - step_id : TD_COAP_CORE_14_step_01
    type : stimuli
    node : coap_client
    description:
      - "Client is requested to send a confirmable GET request with three Query parameters (e.g. ?first=1&second=2&third=3) to the server's resource"

  - step_id : TD_COAP_CORE_14_step_02
    type : check
    description:
      - 'The request sent by the client contains:'
      - - Type=0 (CON)
        - Code=1 (GET)
        - Client-generated Message ID (* CMID)
        - Client-generated Token (* CTOK)
      - 'and two options of Uri-Query, with values such as:'
      - - first=1
        - second=2

  - step_id : TD_COAP_CORE_14_step_03
    type : check
    description:
      - 'Server sends response containing:'
      - - Code=2.05 (Content)
        - Message ID = CMID, Token = CTOK
        - Content-format option
        - Non-empty Payload

  - step_id : TD_COAP_CORE_14_step_04
    type : verify
    node : coap_client
    description:
      - 'Client displays the response'

--- !testcase

testcase_id : TD_COAP_CORE_15
uri : http://doc.f-interop.eu/tests/TD_COAP_CORE_15
objective: Perform GET transaction (CON mode, piggybacked response) in a lossy context
configuration: COAP_CFG_02
references: "[COAP] 4.4.1, 5.2.1, 5.8.1"
pre_conditions:
  - Gateway is introduced and configured to produce packet losses
  - Server offers a /test resource with resource content is not empty that can handle GET
notes: We acknowledge the efforts made by ETSI CTI and ProbeIT who have contributed to the content of this document
sequence:

  - step_id : TD_COAP_CORE_15_step_01
    type : stimuli
    node : coap_client
    description:
      - "Client is requested to send a confirmable GET request to server's resource"

  - step_id : TD_COAP_CORE_15_step_02
    type : check
    description:
      - 'Sent request must contain:'
      - - Type=0
        - Code=1
        - Client-generated Message ID (* CMID)
        - Client-generated Token (* CTOK)

  - step_id : TD_COAP_CORE_15_step_03
    type : check
    description:
      - 'Server sends response containing'
      - - Code=2.05(Content)
        - Message ID = CMID, Token = CTOK
        - Content-format option
        - Non-empty Payload

  - step_id : TD_COAP_CORE_15_step_04
    type : verify
    node : coap_client
    description:
      - 'Client displays the response'

  - step_id : TD_COAP_CORE_15_step_05
    type : check
    description:
      - 'Repeat steps 1-4 until at least one of the following actions has been observed'
      - - 'One dropped request'
        - 'One dropped response'


  - step_id : TD_COAP_CORE_15_step_06
    type : verify
    node : coap_client
    description:
      - 'For each case mentioned in step 5:'
      - 'Observe that retransmission is launched'

--- !testcase

testcase_id : TD_COAP_CORE_16
uri : http://doc.f-interop.eu/tests/TD_COAP_CORE_16
objective: Perform GET transaction (CON mode, delayed response) in a lossy context
configuration: COAP_CFG_02
references: "[COAP] 4.4.1, 5.2.2, 5.8.1"
pre_conditions:
  - Gateway is introduced and configured to produce packet losses
  - Server offers a resource /separate which is not served immediately and which therefore is not acknowledged in a piggybacked way.
notes: We acknowledge the efforts made by ETSI CTI and ProbeIT who have contributed to the content of this document
sequence:

  - step_id : TD_COAP_CORE_16_step_01
    type : stimuli
    node : coap_client
    description:
      - "Client is requested to send a confirmable GET request to server's resource"

  - step_id : TD_COAP_CORE_16_step_02
    type : check
    description:
      - 'The requested sent by the client contains:'
      - - Type=0
        - Code=1
        - Client-generated Message ID (* CMID)

  - step_id : TD_COAP_CORE_16_step_03
    type : check
    description:
      - 'Server sends response containing:'
      - - Type=2 (ACK)
        - Code=0
        - Message ID = CMID
        - Empty Payload

  - step_id : TD_COAP_CORE_16_step_04
    type : check
    description:
      - 'Server sends response containing'
      - - Type=0(CON)
        - Code=2.05(Content)
        - Server-generated Message ID (* SMID)
        - Non-empty Payload
        - Content-format option

  - step_id : TD_COAP_CORE_16_step_05
    type : check
    description:
      - 'Client sends response containing:'
      - - Type=2 (ACK)
        - Code=0
        - Message ID = SMID
        - Empty Payload

  - step_id : TD_COAP_CORE_16_step_06
    type : verify
    node : coap_client
    description:
      - 'Client displays the response'

  - step_id : TD_COAP_CORE_16_step_07
    type : check
    description:
      - 'Repeat steps 1-6 until at least one of the following actions has been observed'
      - - 'One dropped request'
        - 'One dropped request ACK'
        - 'One dropped response'
        - 'One dropped response ACK and its retransmission'


  - step_id : TD_COAP_CORE_16_step_08
    type : verify
    node : coap_client
    description:
      - 'For each case mentioned in step 7:'
      - 'Observe that retransmission is launched'

--- !testcase

testcase_id : TD_COAP_CORE_17
uri : http://doc.f-interop.eu/tests/TD_COAP_CORE_17
objective: Perform GET transaction with a separate response(NON mode)
configuration: COAP_CFG_01
references: "[COAP] 2.2, 5.2.2, 5.8.1"
pre_conditions:
  - Server offers a resource /separate which is not served immediately and which therefore is not acknowledged in a piggybacked way.
notes: We acknowledge the efforts made by ETSI CTI and ProbeIT who have contributed to the content of this document
sequence:

  - step_id : TD_COAP_CORE_17_step_01
    type : stimuli
    node : coap_client
    description:
      - "Client is requested to send a confirmable GET request to server's resource"

  - step_id : TD_COAP_CORE_17_step_02
    type : check
    description:
      - 'The requested sent by the client contains:'
      - - Type=1(NON)
        - Code=1(GET)
        - Client-generated Message ID (* CMID)

  - step_id : TD_COAP_CORE_17_step_03
    type : check
    description:
      - 'Server DOES NOT sends response containing:'
      - - Type=2 (ACK)
        - Same message ID as in the request in step 2
        - Empty Payload
#Some time (a couple of seconds) elapses.
  - step_id : TD_COAP_CORE_17_step_04
    type : check
    description:
      - 'Server sends response containing:'
      - - Type=1(CON)
        - Code=2.05(Content)
        - Server-generated Message ID (* SMID)
        - Content-format option
        - Non-empty Payload

  - step_id : TD_COAP_CORE_17_step_05
    type : verify
    node : coap_client
    description:
      - 'Client displays the response'

--- !testcase

testcase_id : TD_COAP_CORE_18
uri : http://doc.f-interop.eu/tests/TD_COAP_CORE_18
objective: Perform POST transaction with responses containing several Location-Path option(CON mode)
configuration: COAP_CFG_01
references: "[COAP] 2.2, 5.2.2, 5.8.1"
pre_conditions:
  - Server accepts creation of new resource on /test and the created resource is located at /location1/location2:location3 (resource does not exist yet)
notes: We acknowledge the efforts made by ETSI CTI and ProbeIT who have contributed to the content of this document
sequence:

  - step_id : TD_COAP_CORE_18_step_01
    type : stimuli
    node : coap_client
    description:
      - "Client is request to send a confirmable POST request to server's resource"

  - step_id : TD_COAP_CORE_18_step_02
    type : check
    description:
      - 'The requested sent by the client contains:'
      - - Type=0(CON)
        - Code=2(POST)
        - An arbitrary payload
        - Content-format option

  - step_id : TD_COAP_CORE_18_step_03
    type : check
    description:
      - 'Server sends response containing:'
      - - Code=2.05(Content)
      - 'and three options of type Location-Path with the values (none of which contains a "/"):'
      - - location1
        - location2
        - location3

  - step_id : TD_COAP_CORE_18_step_04
    type : verify
    node : coap_client
    description:
      - 'Client displays the response'

--- !testcase

testcase_id : TD_COAP_CORE_19
uri : http://doc.f-interop.eu/tests/TD_COAP_CORE_19
objective: Perform POST transaction with responses containing several Location-Query option(CON mode)
configuration: COAP_CFG_01
references: "[COAP] 5.8.2, 5.10.7, 5.9.1.1"
pre_conditions:
  - Server accepts creation of new resource on uri /location-query, the location of the created resource contains two query parameters ?first=1&second=2
notes: We acknowledge the efforts made by ETSI CTI and ProbeIT who have contributed to the content of this document
sequence:

  - step_id : TD_COAP_CORE_19_step_01
    type : stimuli
    node : coap_client
    description:
      - "Client is requested to send a confirmable POST request to server's resource"

  - step_id : TD_COAP_CORE_19_step_02
    type : check
    description:
      - 'The request sent by the client contains:'
      - - Type=0(CON)
        - Code=2(POST)
        - Client-generated Message ID (* CMID)
        - Client-generated Token (* CTOK)
        - Content-format option
        - Empty or non-empty Payload

  - step_id : TD_COAP_CORE_19_step_03
    type : check
    description:
      - 'Server sends response containing:'
      - - Code=2.05(Content)
        - Message ID = CMID, Token = CTOK
        - Content-format option if payload non-empty
        - Zero or more Location-path option
        - Empty or non-empty Payload
      - 'and two options of type Location-Query, with the values (null of which contains a "?" or "&"):'
      - - first=1
        - second=2

  - step_id : TD_COAP_CORE_19_step_04
    type : verify
    node : coap_client
    description:
      - 'Client displays the response'

--- !testcase

testcase_id : TD_COAP_CORE_20
uri : http://doc.f-interop.eu/tests/TD_COAP_CORE_20
objective: Perform GET transaction containing the Accept option (CON mode)
configuration: COAP_CFG_01
references: "[COAP] 5.8.1, 5.10.5, 5.10.4"
pre_conditions:
  - Server should provide a resource /multi-format which exists in two formats
  - text/plain;charset=utf-8
  - application/xml
notes: We acknowledge the efforts made by ETSI CTI and ProbeIT who have contributed to the content of this document
sequence:

  - step_id : TD_COAP_CORE_20_step_01
    type : stimuli
    node : coap_client
    description:
      - "Client is requested to send a confirmable GET request to server's resource"

  - step_id : TD_COAP_CORE_20_step_02
    type : check
    description:
      - 'The request sent by the client contains:'
      - - Type=0(CON)
        - Code=1(GET)
        - Client-generated Message ID (* CMID)
        - Client-generated Token (* CTOK)
        - Option type = Accept, value=0 (text/plain;charset=utf-8)

  - step_id : TD_COAP_CORE_20_step_03
    type : check
    description:
      - 'Server sends response containing:'
      - - Code=2.05(Content)
        - Message ID = CMID, Token = CTOK
        - Option type = Content-Format, value=0 (text/plain;charset=utf-8)
        - Payload=Content of the requested resource in text/plain;charset=utf-8 format

  - step_id : TD_COAP_CORE_20_step_04
    type : verify
    node : coap_client
    description:
      - 'Client displays the response'
#client requests a resource in xml format
  - step_id : TD_COAP_CORE_20_step_05
    type : stimuli
    node : coap_client
    description:
      - "Client is requested to send a confirmable GET request to server's resource"

  - step_id : TD_COAP_CORE_20_step_06
    type : check
    description:
      - 'The request sent by the client contains:'
      - - Type=0(CON)
        - Code=1(GET)
        - Another client-generated Message ID ≠ CMID (* CMID2)
        - Client-generated Token which may or may not be ≠ CTOK (* CTOK2)
        - Option type = Accept, value=41 (application/xml)

  - step_id : TD_COAP_CORE_20_step_07
    type : check
    description:
      - 'Server sends response containing:'
      - - Code=2.05(Content)
        - Message ID = CMID2, Token = CTOK2
        - Option type = Content-Format, value=41 (application/xml)
      - 'Payload=Content of the requested resource in application/xml format'

  - step_id : TD_COAP_CORE_20_step_08
    type : verify
    node : coap_client
    description:
      - 'Client displays the response'

--- !testcase

testcase_id : TD_COAP_CORE_21
uri : http://doc.f-interop.eu/tests/TD_COAP_CORE_21
objective: Perform GET transaction containing the Etag option (CON mode)
configuration: COAP_CFG_01
references: "[COAP] 5.8.1, 5.10.6, 5.10.10, 12.1.12"
pre_conditions:
  - Server chould offer a /validate resource which may be made to vary over time
  - Client & server support Etag option
  - The client's cache must be purged
notes: We acknowledge the efforts made by ETSI CTI and ProbeIT who have contributed to the content of this document
sequence:
#Verifying that client cache is empty
  - step_id : TD_COAP_CORE_21_step_01
    type : stimuli
    node : coap_client
    description:
      - "Client is requested to send a confirmable GET request to server's resource"

  - step_id : TD_COAP_CORE_21_step_02
    type : check
    description:
      - 'The request sent request by the client contains:'
      - - Type=0(CON)
        - Code=1(GET)
        - Client-generated Message ID (* CMID)
        - Client-generated Token (* CTOK)
        - No ETag option

  - step_id : TD_COAP_CORE_21_step_03
    type : check
    description:
      - 'Server sends response containing:'
      - - Code=2.05(Content)
        - Message ID = CMID, Token = CTOK
        - Option type = ETag, value = a value chosen by the server (* ETAG1)
        - Non-empty Payload

  - step_id : TD_COAP_CORE_21_step_04
    type : verify
    node : coap_client
    description:
      - 'Client displays the response'
#Verifying client cache entry is still valid
  - step_id : TD_COAP_CORE_21_step_05
    type : stimuli
    node : coap_client
    description:
      - "Client is requested to send a confirmable GET request to server's resource so as to check if the resource was updated"

  - step_id : TD_COAP_CORE_21_step_06
    type : check
    description:
      - 'The request sent by the client contains:'
      - - Type=0(CON)
        - Code=1(GET)
        - Another client-generated Message ID ≠ CMID (* CMID2)
        - Client-generated Token which may or may not be ≠ CTOK (* CTOK2)
        - Option type = ETag, value = ETAG1 (the ETag value received in step3)

  - step_id : TD_COAP_CORE_21_step_07
    type : check
    description:
      - 'Server sends response containing:'
      - - Code=2.03(Valid)
        - Message ID = CMID2, Token = CTOK2
        - Option type = ETag, value=ETAG1
        - Empty Payload

  - step_id : TD_COAP_CORE_21_step_08
    type : verify
    node : coap_client
    description:
      - 'Client displays the response'
# Verifying that client cache entry is no longer valid
  - step_id : TD_COAP_CORE_21_step_09
    type : stimuli
    node : coap_client
    description:
      - "Update the content of the server's resource from a CoAP client"

  - step_id : TD_COAP_CORE_21_step_10
    type : stimuli
    node : coap_client
    description:
      - "Client is requested to send a confirmable GET request to server's resource so as to check if the resource was updated"

  - step_id : TD_COAP_CORE_21_step_11
    type : check
    description:
      - 'The request sent by the client contains:'
      - - Type=0(CON)
        - Code=1(GET)
        - Another client-generated Message ID ≠ CMID and ≠ CMID2 (* CMID3)
        - Client-generated Token which may or may not be ≠ CTOK or CTOK2 (* CTOK3)
        - Option type = ETag, value = ETAG1 (the ETag value received in step3)

  - step_id : TD_COAP_CORE_21_step_12
    type : check
    description:
      - 'Server sends response containing:'
      - - Code=2.05(Content)
        - Message ID = CMID3, Token = CTOK3
        - Option type = ETag, value=anoth ETag value ≠ ETAG1
        - 'The payload of the requested resource, which should be different from the payload in step 3'

  - step_id : TD_COAP_CORE_21_step_13
    type : verify
    node : coap_client
    description:
      - 'Client displays the response'

--- !testcase

testcase_id : TD_COAP_CORE_22
uri : http://doc.f-interop.eu/tests/TD_COAP_CORE_22
objective: Perform GET transaction with responses containing the ETag option requests containing the If-Match option (CON mode)
configuration: COAP_CFG_01
references: "[COAP] 5.8.1, 5.10.8, 5.10.9, 12.1.12"
pre_conditions:
  - Server offer a /validate resource
  - Client & server support Etag and if-Match option
  - The client's cache must be purged
notes: We acknowledge the efforts made by ETSI CTI and ProbeIT who have contributed to the content of this document
sequence:
#client gets the resource
  - step_id : TD_COAP_CORE_22_step_01
    type : stimuli
    node : coap_client
    description:
      - "Client is requested to send a confirmable GET request to server's resource"

  - step_id : TD_COAP_CORE_22_step_02
    type : check
    description:
      - 'The request sent request by the client contains:'
      - - Type=0(CON)
        - Code=1(GET)
        - Client-generated Message ID (* CMID)
        - Client-generated Token (* CTOK)
        - No ETag option

  - step_id : TD_COAP_CORE_22_step_03
    type : check
    description:
      - 'Server sends response containing:'
      - - Code=2.05(Content)
        - Message ID = CMID, Token = CTOK
        - Option type = ETag, value = a value chosen by the server (* ETAG1)
        - Non-empty Payload

#Vsingle update
  - step_id : TD_COAP_CORE_22_step_04
    type : stimuli
    node : coap_client
    description:
      - "Client is requested to send a confirmable PUT request to server's resource so as to perform an atomic update"

  - step_id : TD_COAP_CORE_22_step_05
    type : check
    description:
      - 'The request sent by the client contains:'
      - - Type=0(CON)
        - Code=3(PUT)
        - Another client-generated Message ID ≠ CMID (* CMID2)
        - Client-generated Token which may or may not be ≠ CTOK (* CTOK2)
        - Option type = If-Match, value = ETAG1 (ETag value received in step3)
        - An arbitrary payload (Which differs from the payload received in step3)

  - step_id : TD_COAP_CORE_22_step_06
    type : check
    description:
      - 'Server sends response containing:'
      - - Code=2.04(Changed)
        - Message ID = CMID2, Token = CTOK2
        - Content-format option if payload non-empty
        - Empty or non-empty Payload

  - step_id : TD_COAP_CORE_22_step_07
    type : verify
    node : coap_client
    description:
      - 'Client displays the response and the server changed its resource'

# concurrent updates

  - step_id : TD_COAP_CORE_22_step_08
    type : stimuli
    node : coap_client
    description:
      - "Client is requested to send a confirmable GET request to server's resource"

  - step_id : TD_COAP_CORE_22_step_09
    type : check
    description:
      - 'The request sent by the client contains:'
      - - Type=0(CON)
        - Code=1(GET)
        - Another client-generated Message ID ≠ CMID and ≠ CMID2 (* CMID3)
        - Client-generated Token which may or may not be ≠ CTOK or CTOK2 (* CTOK3)

  - step_id : TD_COAP_CORE_22_step_10
    type : check
    description:
      - 'Server sends response containing:'
      - - Code=2.05(Content)
        - Message ID = CMID3, Token = CTOK3
        - Option type = ETag, value = a value ≠ ETAG1 chosen by the server (* ETAG2)
        - The payload sent in step 5

  - step_id : TD_COAP_CORE_22_step_11
    type : verify
    node : coap_client
    description:
      - 'Client displays the response'

  - step_id : TD_COAP_CORE_22_step_12
    type : stimuli
    node : coap_client
    description:
      - "Update the content of the server's resource from a CoAP client"

  - step_id : TD_COAP_CORE_22_step_13
    type : stimuli
    node : coap_client
    description:
      - "Client is requested to send a confirmable PUT request to server's resource so as to perform an atomic update"

  - step_id : TD_COAP_CORE_22_step_14
    type : check
    description:
      - 'The request sent by the client contains:'
      - - Type=0(CON)
        - Code=3(PUT)
        - Another client-generated Message ID ≠ CMID, CMID2, CMID3 (* CMID4)
        - Client-generated Token which may or may not be ≠ CTOK, CTOK2, CTOK3 (* CTOK4)
        - Option type = If-Match, value = ETAG2 (ETag value received in step 10)
        - An arbitrary payload(which differs from the previous pauloads)

  - step_id : TD_COAP_CORE_22_step_15
    type : check
    description:
      - 'Server sends response containing:'
      - - Code=4.12(Precondition Failed)
        - Message ID = CMID4, Token = CTOK4
        - Optional Content-format option
        - Empty or non-empty Payload

  - step_id : TD_COAP_CORE_22_step_16
    type : verify
    node : coap_client
    description:
      - 'Client displays the response and the server did not update the content of the resource'

--- !testcase

testcase_id : TD_COAP_CORE_23
uri : http://doc.f-interop.eu/tests/TD_COAP_CORE_23
objective: Perform PUT transaction containing the If-None-Match option (CON mode)
configuration: COAP_CFG_01
references: "[COAP] 5.8.1, 5.10.7, 5.10.10, 12.1.12"
pre_conditions:
  - Server offer a /create1 resource, which does not exist and can be created by the client
  - Client & server support If-Non-Match option
notes: We acknowledge the efforts made by ETSI CTI and ProbeIT who have contributed to the content of this document
sequence:
#single creation
  - step_id : TD_COAP_CORE_23_step_01
    type : stimuli
    node : coap_client
    description:
      - "Single creation"
      - "Client is requested to send a confirmable PUT request to server’s resource
      so as to atomically create the resource"

  - step_id : TD_COAP_CORE_23_step_02
    type : check
    description:
      - 'The request sent by the client contains:'
      - - Type=0(CON)
        - Code=3(PUT)
        - Client-generated Message ID (* CMID)
        - Client-generated Token (* CTOK)
        - Optionn Type=If-None-Match
        - An arbitrary payload

  - step_id : TD_COAP_CORE_23_step_03
    type : check
    description:
      - 'Server sends response containing:'
      - - Code=2.01(Created)
        - Message ID = CMID, Token = CTOK
        - Content-format option
        - Empty or non-empty Payload

  - step_id : TD_COAP_CORE_23_step_04
    type : verify
    node : coap_client
    description:
      - 'Client displays the response and the server created a new resource'

  - step_id : TD_COAP_CORE_23_step_05
    type : stimuli
    node : coap_client
    description:
      - "Concurrent creations"
      - "Client is requested to send a confirmable PUT request to server's resource so as to atomically create the resource"

  - step_id : TD_COAP_CORE_23_step_06
    type : check
    description:
      - 'The request sent by the client contains:'
      - - Type=0(CON)
        - Code=3(PUT)
        - Another client-generated Message ID ≠ CMID (* CMID2)
        - Client-generated Token which may or may not be ≠ CTOK (* CTOK2)
        - Optionn Type=If-None-Match
        - An arbitrary payload

  - step_id : TD_COAP_CORE_23_step_07
    type : check
    description:
      - 'Server sends response containing:'
      - - Code=4.12(Precondition Failed)
        - Message ID = CMID2, Token = CTOK2
        - Optional Content-format option
        - Empty or non-empty Payload

  - step_id : TD_COAP_CORE_23_step_08
    type : verify
    node : coap_client
    description:
      - 'Client displays the response'

--- !testcase

testcase_id : TD_COAP_CORE_31
uri : http://doc.f-interop.eu/tests/TD_COAP_CORE_31
objective: Perform CoAP Ping (CON mode)
configuration: COAP_CFG_01
references: "[COAP] 4.3"
pre_conditions:
  - (Should work with any CoAP server)
notes: We acknowledge the efforts made by ETSI CTI and ProbeIT who have contributed to the content of this document
sequence:
  - step_id : TD_COAP_CORE_31_step_01
    type : stimuli
    node : coap_client
    description:
      - 'Client is request to send a "Ping" request with:'
      - - Type=0(CON)
        - Code=0(empty)

  - step_id : TD_COAP_CORE_31_step_02
    type : check
    description:
      - 'The request sent by the client is four bytes and contains:'
      - - Type=0 and Code=0
        - Client-generated Message ID (* CMID)
        - Zero-length Token
        - No payload

  - step_id : TD_COAP_CORE_31_step_03
    type : check
    description:
      - 'Server sends four-bytes RST response containing:'
      - - Type=3 and code=0
        - Message ID = CMID
        - Zero-length Token
        - No payload

  - step_id : TD_COAP_CORE_31_step_04
    type : verify
    node : coap_client
    description:
      - 'Client displays that the "Ping" was successful'
        
